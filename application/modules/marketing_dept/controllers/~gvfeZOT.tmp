<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Wuling_gm_stock extends CI_Controller {

	public function __construct()
	{
	    parent::__construct();
	    $this->load->model('model_stock');
	}

	public function index()
	{
		$cek 	= $this->session->userdata('logged_in');
		$level 	= $this->session->userdata('level');
		if(!empty($cek) && $level=='wuling_gm'){
			$d['judul']		= "Data stock";
			$d['class'] 	= "master";
			$d['kode_stock'] = $this->create_kd();
			$d['content'] 	= 'stock/view';
			$d['data'] = $this->model_stock->all();
			$this->load->view('wuling_gm_home',$d);
		}else{
			redirect('wuling','refresh');
		}
	}

	public function create_kd()
	{
		$cek 	= $this->session->userdata('logged_in');
		$level 	= $this->session->userdata('level');
		if(!empty($cek) && $level=='wuling_gm'){

			$last_kd = $this->model_stock->last_kode();
			if($last_kd > 0){
				$no_akhir = $last_kd+1;
				$kd = "stock".sprintf("%03s", $no_akhir);
			}else{
				$kd = 'stock001';
			}
			return $kd;
		}else{
			redirect('wuling','refresh');
		}

	}

	public function cari()
	{
		$cek 	= $this->session->userdata('logged_in');
		$level 	= $this->session->userdata('level');
		if(!empty($cek) && $level=='wuling_gm'){
			$id['id_stock']	= $this->input->get('cari');

			if($this->model_stock->ada($id)) {
				$dt = $this->model_stock->get($id);
				$d['id_stock'] 			= $dt->id_stock;
				$d['kode_stock'] 		= $dt->kode_stock;
				$d['type'] 		= $dt->id_type;
				$d['varian'] 		= $dt->varian;
				$d['configuration'] 		= $dt->id_configuration;
				$d['warna'] 		= $dt->id_warna;
				$d['harga'] 		= separator_harga($dt->harga);
				echo json_encode($d);
			} else {
				$d['id_stock'] 			='';
				$d['kode_stock'] 		= '';
				$d['type'] 		= '';
				$d['varian'] 		= '';
				$d['configuration'] = '';
				$d['warna'] 		= '';
				$d['harga'] 		= '';
				/*$d['cari_perusahaan']	= '';*/
				echo json_encode($d);
			}
		}
		else {
			redirect('wuling','refresh');
		}
	}

	public function simpan()
	{

		$cek = $this->session->userdata('logged_in');
		$level = $this->session->userdata('level');
		if(!empty($cek) && $level=='wuling_gm'){
			$id['id_stock']= $this->input->post('id_stock');
			$dt['kode_stock'] 	= $this->input->post('kode_stock');
			$dt['id_type'] 	= $this->input->post('type');
			$dt['varian'] 	= $this->input->post('varian');
			$dt['id_configuration'] 	= $this->input->post('configuration');
			$dt['id_warna'] 	= $this->input->post('warna');
			$dt['harga'] 	= remove_separator($this->input->post('harga'));
			if($this->model_stock->ada($id)){
				$dt['id_stock'] 	= $this->input->post('id_stock');
				$this->model_stock->update($id, $dt);
				echo "Data Sukses diUpdate";
			}else{

				$dt['id_stock'] 	= $this->model_stock->cari_max_stock();
				$this->model_stock->insert($dt);
				echo "Data Sukses diSimpan";
			}
		}else{
			redirect('wuling','refresh');
		}

	}

	public function hapus()
	{
		$cek = $this->session->userdata('logged_in');
		$level = $this->session->userdata('level');
		if(!empty($cek) && $level=='wuling_gm'){
			$id['id_stock']	= $this->uri->segment(3);

			if($this->model_stock->ada($id))
			{
				$this->model_stock->delete($id);
			}
			redirect('wuling_gm_stock','refresh');
		}
		else
		{
			redirect('wuling','refresh');
		}

	}
}

/* End of file welcome.php */
/* Location: ./application/controllers/welcome.php */
